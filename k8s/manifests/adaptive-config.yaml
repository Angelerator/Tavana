# Adaptive Scaling Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: tavana-adaptive-config
  namespace: tavana
data:
  config.yaml: |
    # Timezone for time-based patterns
    # Configure based on your primary user location
    # Examples: "UTC", "America/New_York", "Europe/London", "Asia/Tokyo", "Australia/Sydney"
    timezone: "UTC"
    
    # Base threshold for query routing (GB)
    # Queries smaller than threshold go to worker pool
    # Queries larger than threshold go to ephemeral pods
    base_threshold_gb: 2
    min_threshold_gb: 0.5
    max_threshold_gb: 20
    
    # HPA base configuration
    base_hpa_min: 2
    base_hpa_max: 10
    absolute_hpa_min: 1
    absolute_hpa_max: 100
    
    # Time-based patterns (in configured timezone)
    # Lower threshold during business hours (more ephemeral pods for isolation)
    # Higher threshold at night (more worker pool for efficiency)
    time_patterns:
      business_hours:
        start_hour: 9
        end_hour: 17
        threshold_factor: 0.8   # 1.6GB during business hours
        hpa_factor: 1.5         # More workers
      night:
        start_hour: 22
        end_hour: 6
        threshold_factor: 1.5   # 3GB at night
        hpa_factor: 0.5         # Fewer workers
    
    # Day-based patterns
    day_patterns:
      weekend:
        days: [6, 7]            # Saturday, Sunday
        threshold_factor: 1.3   # 2.6GB on weekends
        hpa_factor: 0.5         # Fewer workers
      friday:
        days: [5]
        threshold_factor: 0.9
        hpa_factor: 1.2
    
    # Special events
    events:
      - name: month_end
        condition:
          type: DayOfMonth
          min_day: 28
          max_day: 31
        threshold_factor: 0.5   # More aggressive ephemeral pods
        hpa_factor: 2.0         # Double workers
      
      - name: quarter_end
        condition:
          type: QuarterEnd
          start_day: 25
        threshold_factor: 0.3   # Very aggressive
        hpa_factor: 3.0         # Triple workers
    
    # Load-based response
    # Adjusts based on current cluster utilization
    load_response:
      utilization_thresholds: [0.3, 0.5, 0.7, 0.9]
      threshold_factors: [1.5, 1.0, 0.7, 0.5]
      hpa_factors: [0.5, 1.0, 1.5, 2.0]
    
    # Recalculation interval (seconds)
    recalc_interval_secs: 60
