# Tavana Helm Chart - Separ Authentication Integration
# 
# This values file enables Separ integration for centralized authentication
# and authorization. Use this as an overlay on top of your base values.
#
# Usage:
#   helm upgrade tavana ./helm/tavana \
#     -f values.yaml \
#     -f values-separ.yaml \
#     --set auth.separ.existingSecret=your-secret-name
#
# Prerequisites:
#   1. Separ must be deployed and accessible from the Tavana namespace
#   2. Create a Kubernetes secret with the Separ API key:
#      kubectl create secret generic tavana-separ-auth \
#        --namespace tavana \
#        --from-literal=separ-api-key="YOUR_API_KEY"
#   3. The API key must be registered in Separ with appropriate permissions

# Authentication configuration
auth:
  # Set to "required" for mandatory auth, "optional" for hybrid mode
  mode: "required"
  
  # Separ integration
  separ:
    enabled: true
    # Separ service endpoint (adjust based on your deployment)
    # Same namespace: http://separ:8080
    # Different namespace: http://separ.separ.svc.cluster.local:8080
    endpoint: "http://separ.separ.svc.cluster.local:8080"
    # Enable SpiceDB authorization checks
    enableAuthz: true
    # How to extract tenant from username
    # Options: email_domain, backslash_prefix, none
    tenantExtraction: "email_domain"
    # Reference to Kubernetes secret containing the API key
    # NEVER put the actual API key here - use existingSecret
    existingSecret: "tavana-separ-auth"
    existingSecretKey: "separ-api-key"
  
  # Enable caching to reduce calls to Separ
  cache:
    enabled: true
    ttlSecs: 300  # 5 minutes
  
  # Rate limiting for failed auth attempts
  rateLimit:
    enabled: true
    maxFailedAttempts: 5

