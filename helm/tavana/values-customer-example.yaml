# Example Customer Values File
# Copy this file and customize for each customer deployment
#
# Usage:
#   helm upgrade --install tavana ./helm/tavana \
#     -f ./helm/tavana/values-customer-example.yaml \
#     -n tavana --create-namespace

# =============================================================================
# REQUIRED: Customer-Specific Settings
# =============================================================================

global:
  # Customer's container registry
  imageRegistry: "customeracr.azurecr.io"
  # Tavana version to deploy
  imageTag: "1.0.4"

# Registry authentication (if ACR/private registry)
imagePullSecrets:
  - name: acr-secret

# =============================================================================
# INGRESS: Internal Access Configuration
# =============================================================================

ingress:
  enabled: true
  className: ""
  annotations:
    # Azure Application Gateway (private IP)
    kubernetes.io/ingress.class: azure/application-gateway
    appgw.ingress.kubernetes.io/use-private-ip: "true"
    appgw.ingress.kubernetes.io/backend-protocol: "http"
    appgw.ingress.kubernetes.io/health-probe-path: "/health"
    appgw.ingress.kubernetes.io/health-probe-interval: "30"
    appgw.ingress.kubernetes.io/request-timeout: "300"
    appgw.ingress.kubernetes.io/connection-draining: "true"
    appgw.ingress.kubernetes.io/connection-draining-timeout: "30"
  hosts:
    - host: tavana.int.customer.com  # <-- CHANGE THIS
      paths:
        - path: /
          pathType: Prefix
  tls: []
    # Uncomment for HTTPS:
    # - secretName: tavana-tls-secret
    #   hosts:
    #     - tavana.int.customer.com

# =============================================================================
# STORAGE: Object Storage Configuration
# =============================================================================

objectStorage:
  # Azure ADLS Gen2 with S3 API (via Azurite or native)
  endpoint: "https://customerstorage.dfs.core.windows.net"
  bucket: "datalake"
  region: "westeurope"
  pathStyle: true
  # Reference existing secret with credentials
  existingSecret: "storage-credentials"
  existingSecretAccessKeyIdKey: "access-key"
  existingSecretSecretAccessKeyKey: "secret-key"

# =============================================================================
# IDENTITY: Azure Workload Identity (Recommended)
# =============================================================================

serviceAccount:
  create: true
  name: "tavana"
  annotations:
    # Azure Workload Identity for ADLS access (no secrets needed)
    azure.workload.identity/client-id: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

# =============================================================================
# RESOURCES: Adjust Based on Customer's Cluster Size
# =============================================================================

gateway:
  replicaCount: 2
  
  service:
    # Change to 8081 if Azure Policy blocks port 5432
    externalPgPort: 5432
  
  # Enable if AKS has Network Contributor role on VNet
  # This creates a single internal IP for both HTTP and PostgreSQL
  loadBalancer:
    enabled: false  # Set to true if network permissions allow
    annotations:
      service.beta.kubernetes.io/azure-load-balancer-internal: "true"
  
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "4Gi"
      cpu: "2000m"

worker:
  replicaCount: 2
  minReplicas: 2
  maxReplicas: 10  # Adjust based on cluster capacity
  resources:
    requests:
      memory: "2Gi"
      cpu: "500m"
    limits:
      memory: "12Gi"
      cpu: "4000m"
  # Optional: Dedicate nodes for workers
  nodeSelector: {}
    # nodepool: tavana-workers
  tolerations: []
    # - key: "workload"
    #   operator: "Equal"
    #   value: "tavana"
    #   effect: "NoSchedule"

# =============================================================================
# SCALING: HPA Configuration
# =============================================================================

hpa:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  cpuTargetUtilization: 70
  memoryTargetUtilization: 80

# =============================================================================
# SECURITY: Pod Security (usually no changes needed)
# =============================================================================

networkPolicies:
  enabled: true

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000

